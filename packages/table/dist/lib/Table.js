"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const a=require("vue"),R=require("@element-plus/pro-utils"),S=require("element-plus"),re=require("@element-plus/pro-search-bar"),b=require("./index2.js");require("@element-plus/icons-vue");require("@element-plus/pro-button");const ue={loading:{type:Boolean,default:!1},ghost:{type:Boolean,default:!1},keepAlive:{type:Boolean,default:!1},title:String,cellAlign:{type:String,default:"left"},headerCellStyle:{type:Object,default:{}},columns:{type:Array,required:!0},columnEmptyText:{type:[Boolean,String],default:"-"},defaultSize:{type:Number,default:10},ellipsis:{type:Boolean,default:void 0},search:{type:[Boolean,Object],default:void 0},toolbar:{type:Object,default:{placeholder:"请输入关键字",showAction:!0,actionStyle:{}}},options:{type:Boolean,default:!0},tableStyle:{type:Object,default:()=>{}},params:{type:Object,default:{}},pagination:{type:[Boolean,Object],default:!0},dataSource:{type:Object},request:{type:Function},onSearch:{type:Function},onReset:{type:Function},onFilter:{type:Function}};let C;const ie=new Uint8Array(16);function ce(){if(!C&&(C=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!C))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return C(ie)}const r=[];for(let t=0;t<256;++t)r.push((t+256).toString(16).slice(1));function se(t,l=0){return r[t[l+0]]+r[t[l+1]]+r[t[l+2]]+r[t[l+3]]+"-"+r[t[l+4]]+r[t[l+5]]+"-"+r[t[l+6]]+r[t[l+7]]+"-"+r[t[l+8]]+r[t[l+9]]+"-"+r[t[l+10]]+r[t[l+11]]+r[t[l+12]]+r[t[l+13]]+r[t[l+14]]+r[t[l+15]]}const de=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),I={randomUUID:de};function ge(t,l,g){if(I.randomUUID&&!l&&!t)return I.randomUUID();t=t||{};const u=t.random||(t.rng||ce)();if(u[6]=u[6]&15|64,u[8]=u[8]&63|128,l){g=g||0;for(let s=0;s<16;++s)l[g+s]=u[s];return l}return se(u)}const M=a.defineComponent((t,l)=>{const{loading:g,search:u,keepAlive:s,columns:_,params:$,defaultSize:H,pagination:U,dataSource:v,request:j}=t,p=a.ref(g),B=a.ref(!1),d=a.ref({}),D=a.ref(),E=a.ref(),f=a.ref([]),T=a.ref("block"),m=a.ref({data:[],total:0}),i=a.ref({current:1,pageSize:H||10}),V=a.ref([]),z=a.ref(!1),K=a.computed(()=>{var e;return typeof t.search=="object"?((e=t.search)==null?void 0:e.rightTools)||[]:void 0}),F=a.computed(()=>l.slots.title||l.slots.title),N=a.computed(()=>{var n;return((n=t.columns)==null?void 0:n.filter(o=>!o.hideInTable)).map(o=>({...o,id:ge(),name:o.dataField}))}),x=a.computed(()=>z.value?V.value:N.value),L=a.computed(()=>{var n;return{display:"flex",justifyContent:(typeof(t==null?void 0:t.pagination)=="object"?(n=t==null?void 0:t.pagination)==null?void 0:n.align:"right")||"right"}}),O=a.computed(()=>{const e=u||u===void 0?void 0:!0;return _.map(n=>{const{valueType:o,search:c}=n;if(o!="index"&&o!="image"&&o!="avatar"&&o!="tag"&&o!="action"&&(c||c===e))return W(n)}).filter(n=>n)}),w=e=>Object.fromEntries(Object.entries(e)),W=e=>{const{dataField:n="",title:o,valueType:c,valueEnum:P}=e,le=typeof e.search=="object"?e.search:{},oe=typeof u=="object"?u:{};return{label:o,dataField:n,valueType:c,valueOptions:P?R.toOptions(P):void 0,...oe,...le}},h=(e,...n)=>{let o={...e};return n.length&&n.forEach(c=>{typeof c=="object"&&(c.current||c.pageSize)&&(o={...o,...c})}),{current:o.current,pageSize:o.pageSize}},y=async(e={})=>{if(j&&typeof j=="function"&&!p.value)try{p.value=!0;const n=h(i.value),o={...i.value};delete o.current,delete o.pageSize,m.value=await j(n,{...d.value,...o,...e})}catch(n){console.warn(n)}finally{p.value=!1}},G=(e={})=>{const{current:n,pageSize:o}=h(i.value,$,U);if(n==i.value.current&&i.value.pageSize==o)return y(e);i.value.current=n,i.value.pageSize=o},J=(e={})=>{v||y(e)},k=()=>{E.value.clearSelection()},Q=(e={})=>{const n=Object.keys(e);if(!n.length)return!0;let o=0;return n.forEach(c=>{e[c]||++o}),n.length===o},X=()=>{if(console.log(d.value,"searchForm.value"),Q(d.value))return S.ElMessage.warning("筛选栏表单信息为空");y()},Y=()=>{O.value.length&&(T.value=T.value==="block"?"none":"block")},Z=e=>{V.value=N.value.filter(n=>e.includes(n.id)||n.type=="selection"),z.value=!0},ee=()=>{V.value=[],z.value=!1},te=e=>{f.value=e},q=(e,n)=>{const o=h(i.value);if(v)return l.emit("pageChange",{...o,[e]:n});i.value[e]=n},ae=()=>{var e;return(e=D.value)==null?void 0:e.resetFields()},A=()=>a.createVNode("div",{style:{border:"1px solid transparent"}},[a.createVNode(S.ElTable,{ref:E,data:m.value.data,"header-cell-style":{color:"#333",fontWeight:600,background:"#f5f7fa",...t.headerCellStyle},"onSelection-change":te},{default:()=>[a.createVNode(b.TableColumn,{columns:x.value},null)]}),U!==!1&&m.value.total>0&&a.createVNode("div",{class:"pagination-container",style:L.value},[a.createVNode(S.ElPagination,{"current-page":i.value.current,"onUpdate:current-page":[e=>i.value.current=e,e=>q("current",e)],background:!0,total:m.value.total,"page-size":i.value.pageSize,"page-sizes":[10,30,50,100,200],layout:"total, sizes, prev, pager, next, jumper","onUpdate:page-size":e=>q("pageSize",e)},null)])]),ne=()=>{v&&Array.isArray(v)?m.value.data=[...v]:y()};return a.provide("tableProps",{ctx:l,...t,columns:x.value}),a.provide("toolbar",{title:t.title,options:t.options,columns:N.value,showSearchOption:!!O.value.length,config:t.toolbar}),a.watch(()=>t.loading,e=>{p.value=e}),a.watch(()=>[t.defaultSize,t.params,t.pagination],e=>{i.value=h({...i.value,pageSize:e[0]},e[1],e[2])},{deep:!0,immediate:!0}),a.watch(()=>[i.value,t.dataSource],()=>{ne()},{deep:!0,immediate:!0}),l.expose({loading:p,refresh:G,reload:J,clearSelected:k,resetSearchFields:ae}),()=>a.createVNode("div",{id:"pro-table",class:"pro-table",style:B.value?{height:"100vh",background:"#fff"}:{}},[a.withDirectives(a.createVNode(b.Card,{ghost:t.ghost||!1,style:{paddingBottom:0,marginBottom:"20px"}},{default:()=>[a.createVNode(re,{ref:D,modelValue:d.value,"onUpdate:modelValue":e=>d.value=e,items:O.value,rightTools:K.value,inline:typeof u=="object"?(u==null?void 0:u.inline)===void 0?!0:u.inline:!0,onSearch:X,onTools:e=>l.emit("tools",e)},{"right-tools":()=>{var e,n;return(n=(e=l.slots)["search-bar-right-tools"])==null?void 0:n.call(e,{...d.value})}})]}),[[a.vShow,T.value==="block"]]),a.createVNode(b.Card,{ghost:t.ghost||!1},{default:()=>[a.createVNode(b.ToolBar,{onSearchDisplay:Y,onColumnsSettingChange:Z,onColumnsSettingReset:ee,onFullScreenChange:e=>{B.value=e}},{title:()=>{var e;return(e=F.value)==null?void 0:e.call(F,{selection:w(f.value)})},actions:()=>{var e,n;return(n=(e=l.slots).toolbar)==null?void 0:n.call(e,{selection:w(f.value)})}}),f.value.length>0&&a.createVNode(S.ElAlert,{type:"info","close-text":"取消选择",style:{marginBottom:"20px",backgroundColor:"#f5f7fa"},onClose:k},{title:()=>a.createVNode(a.Fragment,null,[a.createTextVNode("已选择 "),a.createVNode("span",{class:"alert-count"},[f.value.length]),a.createTextVNode(" 项")])}),s?a.createVNode(a.KeepAlive,null,[A()]):A()]})])},{name:"ProTable"});M.props=ue;const ve=R.withInstall(M);exports.default=ve;
