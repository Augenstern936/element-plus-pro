"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),t=require("@element-plus/pro-search-bar"),a=require("@element-plus/pro-utils"),l=require("element-plus");require("./style/index.scss.js");const o=require("./typing.js"),r=require("../node_modules/.pnpm/uuid@9.0.1/node_modules/uuid/dist/esm-browser/v4.js"),n=require("./components/Card/index.js"),u=require("./components/ToolBar/index.js"),i=require("./components/TableColumn/index.js"),s=e.defineComponent(((o,s)=>{const{loading:c,search:d,keepAlive:v,columns:p,params:g,defaultSize:f,pagination:h,dataSource:m,request:b}=o,y=e.ref(c),S=e.ref(!1),j=e.ref({}),V=e.ref(),x=e.ref(),z=e.ref([]),N=e.ref("block"),T=e.ref({data:[],total:0}),C=e.ref({current:1,pageSize:f||10}),q=e.ref([]),k=e.ref(!1),w=e.computed((()=>{var e;return"object"==typeof o.search?(null==(e=o.search)?void 0:e.rightTools)||[]:void 0})),E=e.computed((()=>s.slots.title||s.slots.title)),F=e.computed((()=>{var e;return(null==(e=o.columns)?void 0:e.filter((e=>!e.hideInTable))).map((e=>({...e,id:r.default(),name:e.dataField})))})),O=e.computed((()=>k.value?q.value:F.value)),A=e.computed((()=>{var e;return{display:"flex",justifyContent:("object"==typeof(null==o?void 0:o.pagination)?null==(e=null==o?void 0:o.pagination)?void 0:e.align:"right")||"right"}})),P=e.computed((()=>{const e=!d&&void 0!==d||void 0;return p.map((t=>{const{valueType:a,search:l}=t;if("index"!=a&&"image"!=a&&"avatar"!=a&&"tag"!=a&&"action"!=a&&(l||l===e))return _(t)})).filter((e=>e))})),B=e=>Object.fromEntries(Object.entries(e)),_=e=>{const{dataField:t="",title:l,valueType:o,valueEnum:r}=e,n="object"==typeof e.search?e.search:{},u="object"==typeof d?d:{};return{label:l,dataField:t,valueType:o,valueOptions:r?a.toOptions(r):void 0,...u,...n}},M=(e,...t)=>{let a={...e};return t.length&&t.forEach((e=>{"object"==typeof e&&(e.current||e.pageSize)&&(a={...a,...e})})),{current:a.current,pageSize:a.pageSize}},U=async(e={})=>{if(b&&"function"==typeof b&&!y.value)try{y.value=!0;const t=M(C.value),a={...C.value};delete a.current,delete a.pageSize,T.value=await b(t,{...j.value,...a,...e})}catch(t){}finally{y.value=!1}},D=()=>{x.value.clearSelection()},I=()=>{if(((e={})=>{const t=Object.keys(e);if(!t.length)return!0;let a=0;return t.forEach((t=>{e[t]||++a})),t.length===a})(j.value))return l.ElMessage.warning("筛选栏表单信息为空");U()},K=()=>{P.value.length&&(N.value="block"===N.value?"none":"block")},R=e=>{q.value=F.value.filter((t=>e.includes(t.id)||"selection"==t.type)),k.value=!0},W=()=>{q.value=[],k.value=!1},G=e=>{z.value=e},H=(e,t)=>{const a=M(C.value);if(m)return s.emit("pageChange",{...a,[e]:t});C.value[e]=t},J=()=>e.createVNode("div",{style:{border:"1px solid transparent"}},[e.createVNode(l.ElTable,{ref:x,data:T.value.data,"header-cell-style":{color:"#333",fontWeight:600,background:"#f5f7fa",...o.headerCellStyle},"onSelection-change":G},{default:()=>[e.createVNode(i.default,{columns:O.value},null)]}),!1!==h&&T.value.total>0&&e.createVNode("div",{class:"pagination-container",style:A.value},[e.createVNode(l.ElPagination,{"current-page":C.value.current,"onUpdate:current-page":[e=>C.value.current=e,e=>H("current",e)],background:!0,total:T.value.total,"page-size":C.value.pageSize,"page-sizes":[10,30,50,100,200],layout:"total, sizes, prev, pager, next, jumper","onUpdate:page-size":e=>H("pageSize",e)},null)])]);return e.provide("tableProps",{ctx:s,...o,columns:O.value}),e.provide("toolbar",{title:o.title,options:o.options,columns:F.value,showSearchOption:!!P.value.length,config:o.toolbar}),e.watch((()=>o.loading),(e=>{y.value=e})),e.watch((()=>[o.defaultSize,o.params,o.pagination]),(e=>{C.value=M({...C.value,pageSize:e[0]},e[1],e[2])}),{deep:!0,immediate:!0}),e.watch((()=>[C.value,o.dataSource]),(()=>{m&&Array.isArray(m)?T.value.data=[...m]:U()}),{deep:!0,immediate:!0}),s.expose({loading:y,refresh:(e={})=>{const{current:t,pageSize:a}=M(C.value,g,h);if(t==C.value.current&&C.value.pageSize==a)return U(e);C.value.current=t,C.value.pageSize=a},reload:(e={})=>{m||U(e)},clearSelected:D,resetSearchFields:()=>{var e;return null==(e=V.value)?void 0:e.resetFields()}}),()=>e.createVNode("div",{id:"pro-table",class:"pro-table",style:S.value?{height:"100vh",background:"#fff"}:{}},[e.withDirectives(e.createVNode(n.default,{ghost:o.ghost||!1,style:{paddingBottom:0,marginBottom:"20px"}},{default:()=>[e.createVNode(t,{ref:V,modelValue:j.value,"onUpdate:modelValue":e=>j.value=e,items:P.value,rightTools:w.value,inline:"object"!=typeof d||(void 0===(null==d?void 0:d.inline)||d.inline),onSearch:I,onTools:e=>s.emit("tools",e)},{"right-tools":()=>{var e,t;return null==(t=(e=s.slots)["search-bar-right-tools"])?void 0:t.call(e,{...j.value})}})]}),[[e.vShow,"block"===N.value]]),e.createVNode(n.default,{ghost:o.ghost||!1},{default:()=>[e.createVNode(u.default,{onSearchDisplay:K,onColumnsSettingChange:R,onColumnsSettingReset:W,onFullScreenChange:e=>{S.value=e}},{title:()=>{var e;return null==(e=E.value)?void 0:e.call(E,{selection:B(z.value)})},actions:()=>{var e,t;return null==(t=(e=s.slots).toolbar)?void 0:t.call(e,{selection:B(z.value)})}}),z.value.length>0&&e.createVNode(l.ElAlert,{type:"info","close-text":"取消选择",style:{marginBottom:"20px",backgroundColor:"#f5f7fa"},onClose:D},{title:()=>e.createVNode(e.Fragment,null,[e.createTextVNode("已选择 "),e.createVNode("span",{class:"alert-count"},[z.value.length]),e.createTextVNode(" 项")])}),v?e.createVNode(e.KeepAlive,null,[J()]):J()]})])}),{name:"ProTable"});s.props=o.proTableProps;const c=a.withInstall(s);exports.default=c;
