"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=require("vue"),le=require("@element-plus/pro-search-bar"),x=require("@element-plus/pro-utils"),m=require("element-plus");require("./style/index.scss.js");const oe=require("./typing.js"),ne=require("../node_modules/.pnpm/uuid@9.0.1/node_modules/uuid/dist/esm-browser/v4.js"),w=require("./components/Card/index.js"),re=require("./components/ToolBar/index.js"),ie=require("./components/TableColumn/index.js"),A=t.defineComponent((o,i)=>{const{loading:B,search:s,keepAlive:I,columns:R,params:U,defaultSize:M,pagination:N,dataSource:u,request:p}=o,c=t.ref(B),V=t.ref(!1),d=t.ref({}),j=t.ref(),E=t.ref(),g=t.ref([]),S=t.ref("block"),f=t.ref({data:[],total:0}),r=t.ref({current:1,pageSize:M||10}),b=t.ref([]),y=t.ref(!1),$=t.computed(()=>{var e;return typeof o.search=="object"?(e=o.search.rightTools)!=null?e:[]:void 0}),C=t.computed(()=>i.slots.title||i.slots.title),z=t.computed(()=>{var a,l;return((l=(a=o.columns)==null?void 0:a.filter(n=>!n.hideInTable))!=null?l:[]).map(n=>({...n,id:ne.default(),name:n.dataField}))}),q=t.computed(()=>y.value?b.value:z.value),_=t.computed(()=>({display:"flex",justifyContent:(typeof(o==null?void 0:o.pagination)=="object"?o.pagination.align:"right")||"right"})),T=t.computed(()=>{const e=s||s===void 0?void 0:!0;return R.map(a=>{const{valueType:l,search:n}=a;if(l!="index"&&l!="image"&&l!="avatar"&&l!="tag"&&l!="action"&&(n||n===e))return K(a)}).filter(a=>a)}),k=e=>Object.fromEntries(Object.entries(e)),K=e=>{const{dataField:a="",title:l,valueType:n,valueEnum:P}=e,te=typeof e.search=="object"?e.search:{},ae=typeof s=="object"?s:{};return{label:l,dataField:a,valueType:n,valueOptions:P?x.toOptions(P):void 0,...ae,...te}},v=(e,...a)=>{let l={...e};return a.length&&a.forEach(n=>{typeof n=="object"&&(n.current||n.pageSize)&&(l={...l,...n})}),{current:l.current,pageSize:l.pageSize}},h=async(e={})=>{if(p&&typeof p=="function"&&!c.value)try{c.value=!0;const a=v(r.value),l={...r.value};delete l.current,delete l.pageSize,f.value=await p(a,{...d.value,...l,...e})}catch(a){console.warn(a)}finally{c.value=!1}},L=(e={})=>{const{current:a,pageSize:l}=v(r.value,U,N);if(a==r.value.current&&r.value.pageSize==l)return h(e);r.value.current=a,r.value.pageSize=l},W=(e={})=>{u||h(e)},F=()=>{E.value.clearSelection()},G=(e={})=>{const a=Object.keys(e);if(!a.length)return!0;let l=0;return a.forEach(n=>{e[n]||++l}),a.length===l},H=()=>{if(G(d.value))return m.ElMessage.warning("筛选栏表单信息为空");h()},J=()=>{T.value.length&&(S.value=S.value==="block"?"none":"block")},Q=e=>{b.value=z.value.filter(a=>e.includes(a.id)||(a==null?void 0:a.type)=="selection"),y.value=!0},X=()=>{b.value=[],y.value=!1},Y=e=>{g.value=e},D=(e,a)=>{const l=v(r.value);if(u)return i.emit("pageChange",{...l,[e]:a});r.value[e]=a},Z=()=>{var e;return(e=j.value)==null?void 0:e.resetFields()},O=()=>t.createVNode("div",{style:{border:"1px solid transparent"}},[t.createVNode(m.ElTable,{ref:E,data:f.value.data,"header-cell-style":{color:"#333",fontWeight:600,background:"#f5f7fa",...o.headerCellStyle},"onSelection-change":Y},{default:()=>[t.createVNode(ie.default,{columns:q.value},null)]}),N!==!1&&f.value.total>0&&t.createVNode("div",{class:"pagination-container",style:_.value},[t.createVNode(m.ElPagination,{"current-page":r.value.current,"onUpdate:current-page":[e=>r.value.current=e,e=>D("current",e)],background:!0,total:f.value.total,"page-size":r.value.pageSize,"page-sizes":[10,30,50,100,200],layout:"total, sizes, prev, pager, next, jumper","onUpdate:page-size":e=>D("pageSize",e)},null)])]),ee=()=>{u&&Array.isArray(u)?f.value.data=[...u]:h()};return t.provide("tableProps",{ctx:i,...o,columns:q.value}),t.provide("toolbar",{title:o.title,options:o.options,columns:z.value,showSearchOption:!!T.value.length,config:o.toolbar}),t.watch(()=>o.loading,e=>{c.value=e}),t.watch(()=>[o.defaultSize,o.params,o.pagination],e=>{r.value=v({...r.value,pageSize:e[0]},e[1],e[2])},{deep:!0,immediate:!0}),t.watch(()=>[r.value,o.dataSource],()=>{ee()},{deep:!0,immediate:!0}),i.expose({loading:c,refresh:L,reload:W,clearSelected:F,resetSearchFields:Z}),()=>t.createVNode("div",{id:"pro-table",class:"pro-table",style:V.value?{height:"100vh",background:"#fff"}:{}},[t.withDirectives(t.createVNode(w.default,{ghost:o.ghost||!1,style:{paddingBottom:0,marginBottom:"20px"}},{default:()=>[t.createVNode(le,{ref:j,modelValue:d.value,"onUpdate:modelValue":e=>d.value=e,items:T.value,rightTools:$.value,inline:typeof s=="object"?s.inline===void 0?!0:s.inline:!0,onSearch:H,onTools:e=>i.emit("tools",e)},{"right-tools":()=>{var e,a;return(a=(e=i.slots)["search-bar-right-tools"])==null?void 0:a.call(e,{...d.value})}})]}),[[t.vShow,S.value==="block"]]),t.createVNode(w.default,{ghost:o.ghost||!1},{default:()=>[t.createVNode(re.default,{onSearchDisplay:J,onColumnsSettingChange:Q,onColumnsSettingReset:X,onFullScreenChange:e=>{V.value=e}},{title:()=>{var e;return(e=C.value)==null?void 0:e.call(C,{selection:k(g.value)})},actions:()=>{var e,a;return(a=(e=i.slots).toolbar)==null?void 0:a.call(e,{selection:k(g.value)})}}),g.value.length>0&&t.createVNode(m.ElAlert,{type:"info","close-text":"取消选择",style:{marginBottom:"20px",backgroundColor:"#f5f7fa"},onClose:F},{title:()=>t.createVNode(t.Fragment,null,[t.createTextVNode("已选择 "),t.createVNode("span",{class:"alert-count"},[g.value.length]),t.createTextVNode(" 项")])}),I?t.createVNode(t.KeepAlive,null,[O()]):O()]})])},{name:"ProTable"});A.props=oe.proTableProps;const se=x.withInstall(A);exports.default=se;
